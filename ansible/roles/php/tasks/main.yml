---
- name: install
  apt: name={{ item }} state=present
  with_items: php.modules
  notify:
      - restart php5-fpm

- name: remove existing cli php.ini
  file: path=/etc/php5/cli/php.ini state=absent

- name: configure cli php.ini
  ini_file:
    section=PHP
    option={{ item.key }}
    value={{ item.value }}
    dest=/etc/php5/cli/php.ini
  with_dict: php.cli
  notify:
      - restart php5-fpm

- name: remove existing fpm php.ini
  file: path=/etc/php5/fpm/php.ini state=absent

- name: configure fpm php.ini
  ini_file:
    section=PHP
    option={{ item.key }}
    value={{ item.value }}
    dest=/etc/php5/fpm/php.ini
  with_dict: php.fpm
  notify:
      - restart php5-fpm

- name: fpm pool config
  copy:
    src=www.conf
    dest=/etc/php5/fpm/pool.d/www.conf
  notify:
    - restart php5-fpm

- name: composer install
  shell: curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin

- name: php-cs-fixer install
  shell: curl -sS http://get.sensiolabs.org/php-cs-fixer.phar -o /usr/local/bin/php-cs-fixer.phar && chmod +x /usr/local/bin/php-cs-fixer.phar