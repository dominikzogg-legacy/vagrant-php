---
- name: install core, common, cli, fpm
  apt: name={{ item }} state=present
  with_items:
      - php5
      - php5-common
      - php5-cli
      - php5-fpm
  notify:
      - restart php5-fpm

- name: install sybase
  apt: name={{ item }} state=present
  with_items:
      - php5-sybase
  notify:
      - restart php5-fpm
  when: role.freetds

- name: install mysqlnd
  apt: name={{ item }} state=present
  with_items:
      - php5-mysqlnd
  notify:
      - restart php5-fpm
  when: role.mariadb

- name: install pgsql
  apt: name={{ item }} state=present
  with_items:
      - php5-pgsql
  notify:
      - restart php5-fpm
  when: role.postgresql

- name: install mongo
  apt: name={{ item }} state=present
  with_items:
      - php5-mongo
  notify:
      - restart php5-fpm
  when: role.mongodb

- name: install modules
  apt: name="php5-{{ php.modules|join(',php5-') }}" state=present
  notify:
      - restart php5-fpm

- name: configure cli php.ini
  template:
    src=cli.php.ini.j2
    dest=/etc/php5/cli/php.ini

- name: configure fpm php.ini
  template:
    src=fpm.php.ini.j2
    dest=/etc/php5/fpm/php.ini
  notify:
      - restart php5-fpm

- name: fpm pool config
  template:
    src=www.conf.j2
    dest=/etc/php5/fpm/pool.d/www.conf
  notify:
    - restart php5-fpm

